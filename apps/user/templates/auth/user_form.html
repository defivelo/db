{% extends "base.html" %}
{% load i18n %}
{% load account %}
{% load bootstrap3 %}
{% load permission_tags %}

{% block head_title %}{% trans "Profil" %}{% endblock %}

{% block content %}
    <h2>{% if not userprofile %}{% trans "Nouvel utilisateur" %}
        {% else %}{% user_display userprofile %}
        {% endif %}</h2>
    <form method="POST" action="" class="form-horizontal">
        {% csrf_token %}

        <div>

        {% comment %}
        {# Pas pour l'instant #}
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#addr" aria-controls="coord" role="tab" data-toggle="tab">{% trans "Adresse" %}</a></li>
                <li role="presentation"><a href="#contacts" aria-controls="contacts" role="tab" data-toggle="tab">{% trans "Contacts" %}</a></li>
                <li role="presentation"><a href="#administrativia" aria-controls="administrativia" role="tab" data-toggle="tab">{% trans "Administratif" %}</a></li>
                <li role="presentation"><a href="#defi" aria-controls="defi" role="tab" data-toggle="tab">{% trans "Défi" %}</a></li>
                <li role="presentation"><a href="#cantons" aria-controls="cantons" role="tab" data-toggle="tab">{% trans "Cantons" %}</a></li>
                <li role="presentation"><a href="#notes" aria-controls="notes" role="tab" data-toggle="tab">{% trans "Notes" %}</a></li>
            </ul>
        {% endcomment %}

        <!-- Tab panes -->
        <div{% comment %} class="tab-content"{% endcomment %}>
            <div role="tabpanel" class="tab-pane active" id="addr">
                {% bootstrap_field form.first_name layout='horizontal' size='small' %}
                {% bootstrap_field form.last_name layout='horizontal' size='small' %}
                {% include "address_bootstrap_form.html" %}
            </div>
            <div role="tabpanel" class="tab-pane" id="contacts">
                {% bootstrap_field form.natel layout='horizontal' size='small' %}
                {% if form.email %}
                    {% bootstrap_field form.email layout='horizontal' size='small' %}
                {% endif %}
            </div>
            <div role="tabpanel" class="tab-pane" id="administrativia">
                {% bootstrap_field form.birthdate layout='horizontal' size='small' %}
                {% bootstrap_field form.iban layout='horizontal' size='small' %}
                {% bootstrap_field form.social_security layout='horizontal' size='small' %}
            </div>
            
            {% with disabled=request.user|can:'user_crud_dv_public_fields'|yesno:',True' %}
            <div role="tabpanel" class="tab-pane" id="defi">
                {% if request.user|can:'user_crud_dv_private_fields' %}
                <div class="form-group form-group-sm">
                    {% bootstrap_label form.office_member.label label_class='col-md-3 control-label' %}
                    <div class="col-md-1">
                        <div class="checkbox">
                            <label for="id_office_member">
                                <input {% if form.office_member.value %}checked="checked" {% endif %}
                                       {% if disabled %}disabled="disabled" {% endif %}
                                       id="id_office_member" name="office_member" type="checkbox" />
                            </label>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% bootstrap_field form.formation layout='horizontal' size='small' set_disabled=disabled %}
                {% bootstrap_field form.actor_for layout='horizontal' size='small' set_disabled=disabled %}
                {% bootstrap_field form.status layout='horizontal' size='small' set_disabled=disabled %}
                {% bootstrap_field form.pedagogical_experience layout='horizontal' size='small' set_disabled=disabled %}
                <div class="form-group form-group-sm">
                    {% bootstrap_label form.firstmed_course.label label_class='col-md-3 control-label' %}
                    <div class="col-md-1">
                        <div class="checkbox">
                            <label for="id_firstmed_course">
                                <input {% if form.firstmed_course.value %}checked="checked" {% endif %}
                                       {% if disabled %}disabled="disabled" {% endif %}
                                       id="id_firstmed_course" name="firstmed_course" type="checkbox" />
                            </label>
                        </div>
                    </div>
                    {% bootstrap_field form.firstmed_course_comm field_class='col-md-8' form_group_class='none' show_label=False set_disabled=disabled %}
                </div>
                {% bootstrap_field form.bagstatus layout='horizontal' size='small' set_disabled=disabled %}
            </div>
            <div role="tabpanel" class="tab-pane" id="cantons">
                {% bootstrap_field form.affiliation_canton layout='horizontal' size='small' set_disabled=disabled %}
                {% bootstrap_field form.activity_cantons layout='horizontal' size='small' set_disabled=disabled %}
            </div>
            {% endwith %}
            {% if request.user|can:'user_crud_dv_private_fields' %}
                <div role="tabpanel" class="tab-pane" id="notes">
                    {% bootstrap_field form.comments layout='horizontal' size='small' %}
                </div>
            {% endif %}
        </div>

        </div>

        {% buttons %}
            <button type="submit" class="btn btn-primary pull-right">{% if userprofile %}{% trans 'Update' %}{% else %}{% trans 'Créer' %}{% endif %}</button>
            {% if userprofile == request.user %}
                <a class="btn btn-default pull-right" href="{% url 'account_email' %}">{% blocktrans with email=request.user.email %}Changer d'email ({{ email }}){% endblocktrans %}</a>
            {% else %}
                <a class="btn btn-default" href="{% url 'user-list' %}">{% trans "Annuler" %}</a>
            {% endif %}
        {% endbuttons %}
    </form>

{% endblock %}

{% block bootstrap3_extra_script %}
{{ form.media.js }}
{% if request.user|can:'user_crud_dv_public_fields' %}
<script type="text/javascript">

function officeMembersSuperPowers() {
  if ($( "#id_office_member" ).is(":checked")) {
    $( "#id_formation" ).prop("disabled", true);
    $( "#id_formation" ).val('');
  }
  else {
    $( "#id_formation" ).prop("disabled", false);
  }
}

function dvCantonsNotAffiliatedToMobile() {
    // Ne permet pas la coche dans le canton d'activité pour Défi Vélo Mobile
    homecanton = $( "#id_affiliation_canton" ).val();
    $( '#id_activity_cantons input[disabled]').prop("disabled", false);
    $( '#id_activity_cantons input[value="' + homecanton + '"]').prop("disabled", true);
}

$( "#id_office_member" ).change( officeMembersSuperPowers );
$( "#id_affiliation_canton" ).change( dvCantonsNotAffiliatedToMobile );

officeMembersSuperPowers();
dvCantonsNotAffiliatedToMobile();
</script>
{% endif %}
{% endblock %}