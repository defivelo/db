{% extends "base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load dv_filters %}
{% block head_title %}{% trans "Session" %} {{ session.pk }}{% endblock %}

{% block content %}
    <h1>{{ session.organization.name }}{% if session.address_city %}, {{ session.address_city }}{% elif session.organization.address_city %}, {{ session.organization.address_city }}{% endif %}
    </h1>
    <h2>{{ session.day|date:"j F" }}{% if session.begin %}, {{ session.begin }}{% endif %}</h2>

    <div class="hidden-print">
        <a class="btn btn-primary pull-right" href="{% url 'session-update' seasonpk=season.pk pk=session.pk %}">{% trans "Éditer" %}</a>
    </div>
    <table class="table">
    <tr class="hidden-print"><th>{% trans "Établissement" %}</th>
        <td><a href="{% url 'organization-detail' session.organization.pk %}">{{ session.organization.name }}</a></td>
    </tr>
    <tr><th>{% trans "Emplacement de la session" %}</th>
        <td>{{ session.address_street }} {{ session.address_no }}<br />
            {{ session.address_city }}{% if session.canton %} ({{ session.address_canton }}){% endif %}
        </td>
    </tr>
    <tr class="hidden-print"><th>{% trans "Date" %}</th><td>{{ session.day|date:"l, j F Y" }}</td></tr>
    {% if session.begin and session.duration %}
        <tr><th>{% trans "Horaire" %}</th><td>{{ session.begin }} - {{ session.end }}</td></tr>
    {% endif %}
    {% if session.fallback %}
        <tr><th>{% trans "Mauvais temps" %}</th><td>{{ session.fallback }}</td></tr>
    {% endif %} 
    {% if session.apples %}
        <tr><th>{% trans "Pommes" %}</th><td>{{ session.apples }}</td></tr>
    {% endif %} 
    <tr><th>{% trans "Rendez-vous moniteurs" %}</th>
        <td>
            {{ session.helpers_time_with_default }}<br />
            {{ session.helpers_place }}
        </td>
    </tr>
    
    <tr>
        <th>{% trans "Disponibilités" %}</th>
        <td>
            {% blocktrans count counter=session.helper_availabilities.1 with formation=1 needs=session.helper_needs.1 %}Moniteur {{ formation }} : 1/{{ needs }}{% plural %}Moniteurs {{ formation }} : {{ counter }}/{{ needs }}{% endblocktrans %}
            <br />
            {% blocktrans count counter=session.helper_availabilities.2 with formation=2 needs=session.helper_needs.2 %}Moniteur {{ formation }} : 1/{{ needs }}{% plural %}Moniteurs {{ formation }} : {{ counter }}/{{ needs }}{% endblocktrans %}
            <br />
            {% blocktrans count counter=session.actor_availabilities with needs=session.actor_needs %}Intervenant : 1/{{ needs }}{% plural %}Intervenants  : {{ counter }}/{{ needs }}{% endblocktrans %}
    </tr>
    
    {% if session.errors %}
        <tr><th>{% trans "Erreurs" %}</th><td>{{ session.errors }}</td></tr>
    {% endif %}
    {% if session.comments %}
        <tr><th>{% trans "Remarques" %}</th><td>{{ session.comments }}</td></tr>
    {% endif %}
    </table>

    <h2>{% trans "Qualifications" %}</h2>
    <table class="table">
    {% if session.qualifications.count > 0 %}
        <tr><td></td>
            {% for quali in session.qualifications.all %}
                <th>{{ forloop.counter }} - <a href="{% url 'quali-update' seasonpk=season.pk sessionpk=session.pk pk=quali.pk %}">{{ quali.name }}</a>
                {% if quali.errors %}
                    <br />
                    {{ quali.errors }}
                {% endif %}
                </th>
            {% endfor %}
        </tr>
        <tr><th>{% trans "Classe" %}</th>
                {% for quali in session.qualifications.all %}
                    <td>{{ quali.class_teacher_fullname }}<br />
                        <small><a href="tel:{{ quali.class_teacher_natel }}">{{ quali.class_teacher_natel }}</a></small>
                        {% if quali.n_participants %}<br />
                            {% blocktrans with n=quali.n_participants %}{{ n }} participants{% endblocktrans %}
                        {% endif %}
                    </td>
                {% endfor %}
        </tr>
        <tr><th>{% trans "Moniteur 2" %}</th>
                {% for quali in session.qualifications.all %}<td>{{ quali.leader|profile_tag }}</td>{% endfor %}</tr>
        <tr><th>{% trans "Moniteurs 1" %}</th>
                {% for quali in session.qualifications.all %}<td>{% for helper in quali.helpers.all %}{{ helper|profile_tag }}<br />{% endfor %}</td>{% endfor %}</tr>
        <tr><th>{% trans "Vélo dans la rue" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.activity_A|default:"" }}</em></td>{% endfor %}</tr>
        <tr><th>{% trans "Mécanique" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.activity_B|default:"" }}</em></td>{% endfor %}</tr>
        <tr><th>{% trans "Rencontre" %}</th>
                {% for quali in session.qualifications.all %}
                    <td>
                    <em>{{ quali.activity_C|default:"" }}</em><br />
                    {{ quali.actor|profile_tag }}
                    </td>
                {% endfor %}
        </tr>
        <tr><th>{% trans "Parcours" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.route|default:"" }}</em></td>{% endfor %}</tr>
        <tr><th>{% trans "Besoins" %}</th>
                {% for quali in session.qualifications.all %}
                    <td>{% if quali.n_bikes %}
                            {% blocktrans count n=quali.n_bikes %}1 vélo{% plural %}{{ n }} vélos{% endblocktrans %}
                        {% endif %}
                        {% if quali.n_helmets %}<br />
                            {% blocktrans count n=quali.n_helmets %}1 casque{% plural %}{{ n }} casques{% endblocktrans %}
                        {% endif %}
                    </td>
                {% endfor %}
        </tr>
        <tr><th>{% trans "Remarques" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.comments }}</em></td>{% endfor %}</tr>
        <tr class="hidden-print"><td></td>
                {% for quali in session.qualifications.all %}
                    <td>
                        <a class="btn btn-primary btn-xs" href="{% url 'quali-update' seasonpk=season.pk sessionpk=session.pk pk=quali.pk %}">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>{% trans "Éditer" %}
                        </a><br />
                        <a class="btn btn-danger btn-xs" href="{% url 'quali-delete' seasonpk=season.pk sessionpk=session.pk pk=quali.pk %}">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>{% trans "Supprimer" %}
                        </a>
                    </td>
                {% endfor %}
        </tr>
    {% endif %}

    <tr class="hidden-print">
        <td{% if session.qualifications.count > 0 %} colspan="{{ session.qualifications.count|add:1 }}"{% endif %}>
            <a class="btn btn-primary pull-right" href="{% url 'quali-create' seasonpk=season.pk sessionpk=session.pk %}">{% trans "Créer une qualification" %}</a>
        </td>
    </tr>
    </table>

    <div class="hidden-print">
        <a class="btn btn-danger pull-right" href="{% url 'session-delete' seasonpk=season.pk pk=session.pk %}">{% trans "Supprimer" %}</a>
        <a class="btn btn-default" href="{% url 'session-list' seasonpk=season.pk year=session.day|date:"Y" week=session.day|weeknumber %}">{% trans "Retour à la liste des sessions" %}</a>
    </div>
{% endblock %}