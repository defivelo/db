{% extends "base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load dv_filters %}
{% block head_title %}{% trans "Session" %}{% endblock %}

{% block content %}
    <h1>{{ session }}</h1>

    <div>
        <a class="btn btn-primary pull-right" href="{% url 'session-update' pk=session.pk %}">{% trans "Éditer" %}</a>
     </div>
    <table class="table">
    <tr><th>{% trans "Établissement" %}</th><td>{{ session.organization.name }}</td></tr>
    <tr><th>{% trans "Date" %}</th><td>{{ session.day|date:"l, j F Y" }}</td></tr>
    <tr><th>{% trans "Horaire" %}</th><td>{{ session.timeslot }}</td></tr>
    {% if session.apples %}
        <tr><th>{% trans "Pommes" %}</th><td>{{ session.apples }}</td></tr>
    {% endif %} 
    {% if session.helpers_time or session.helpers_place %}
        <tr><th>{% trans "Rendez-vous moniteurs" %}</th>
            <td>
                {{ session.helpers_time|default:"" }}<br />
                {{ session.helpers_place }}
            </td>
        </tr>
    {% endif %}
    {% if session.errors %}
        <tr><th>{% trans "Erreurs" %}</th><td>{{ session.errors }}</td></tr>
    {% endif %}
    {% if session.comments %}
        <tr><th>{% trans "Remarques" %}</th><td>{{ session.comments }}</td></tr>
    {% endif %}
    </table>

    <h2>{% trans "Qualifications" %}</h2>
    <table class="table">
    {% if session.qualifications.count > 0 %}
        <tr><td></td>
            {% for quali in session.qualifications.all %}
                <th>{{ forloop.counter }} - <a href="{% url 'quali-update' session=session.id pk=quali.pk %}">{{ quali.name }}</a>
                {% if quali.errors %}
                    <br />
                    {{ quali.errors }}
                {% endif %}
                </th>
            {% endfor %}
        </tr>
        <tr><th>{% trans "Classe" %}</th>
                {% for quali in session.qualifications.all %}
                    <td>{{ quali.class_teacher_fullname }}<br />
                        <small><a href="tel:{{ quali.class_teacher_natel }}">{{ quali.class_teacher_natel }}</a></small>
                        {% if quali.n_participants %}<br />
                            {% blocktrans with n=quali.n_participants %}{{ n }} participants{% endblocktrans %}
                        {% endif %}
                    </td>
                {% endfor %}
        </tr>
        <tr><th>{% trans "Moniteur 2" %}</th>
                {% for quali in session.qualifications.all %}<td>{{ quali.leader|profile_tag }}</td>{% endfor %}</tr>
        <tr><th>{% trans "Moniteurs 1" %}</th>
                {% for quali in session.qualifications.all %}<td>{% for helper in quali.helpers.all %}{{ helper|profile_tag }}<br />{% endfor %}</td>{% endfor %}</tr>
        <tr><th>{% trans "Vélo dans la rue" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.activity_A|default:"" }}</em></td>{% endfor %}</tr>
        <tr><th>{% trans "Mécanique" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.activity_B|default:"" }}</em></td>{% endfor %}</tr>
        <tr><th>{% trans "Rencontre" %}</th>
                {% for quali in session.qualifications.all %}
                    <td>
                    <em>{{ quali.activity_C|default:"" }}</em><br />
                    {{ quali.actor|profile_tag }}
                    </td>
                {% endfor %}
        </tr>
        <tr><th>{% trans "Parcours" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.route|default:"" }}</em></td>{% endfor %}</tr>
        <tr><th>{% trans "Besoins" %}</th>
                {% for quali in session.qualifications.all %}
                    <td>{% if quali.n_bikes %}
                            {% blocktrans count n=quali.n_bikes %}1 vélo{% plural %}{{ n }} vélos{% endblocktrans %}
                        {% endif %}
                        {% if quali.n_helmets %}<br />
                            {% blocktrans count n=quali.n_helmets %}1 casque{% plural %}{{ n }} casques{% endblocktrans %}
                        {% endif %}
                    </td>
                {% endfor %}
        </tr>
        <tr><th>{% trans "Remarques" %}</th>
                {% for quali in session.qualifications.all %}<td><em>{{ quali.comments }}</em></td>{% endfor %}</tr>
        <tr><td></td>
                {% for quali in session.qualifications.all %}
                    <td>
                        <a class="btn btn-primary btn-xs" href="{% url 'quali-update' session=session.id pk=quali.pk %}">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>{% trans "Éditer" %}
                        </a><br />
                        <a class="btn btn-danger btn-xs" href="{% url 'quali-delete' session=session.id pk=quali.pk %}">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>{% trans "Supprimer" %}
                        </a>
                    </td>
                {% endfor %}
        </tr>
    {% endif %}

    <tr>
        <td{% if session.qualifications.count > 0 %} colspan="{{ session.qualifications.count|add:1 }}"{% endif %}>
            <a class="btn btn-primary pull-right" href="{% url 'quali-create' session=session.pk %}">{% trans "Créer une qualification" %}</a>
        </td>
    </tr>
    </table>

    <div>
        <a class="btn btn-danger pull-right" href="{% url 'session-delete' pk=session.pk %}">{% trans "Supprimer" %}</a>
        <a class="btn btn-default" href="{% url 'session-list' %}">{% trans "Retour à la liste des sessions" %}</a>
    </div>
{% endblock %}